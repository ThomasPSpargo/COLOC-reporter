## COLOC-reporter manuscript materials

This directory stores scripts related to the manuscript associated with the COLOC-reporter repository (reference __TBD__). Specifically, it details summary statistic processing performed and analysis with [LDSC](https://github.com/bulik/ldsc) and [LAVA](https://github.com/josefin-werme/LAVA).

In the associated study, genomic regions associated between trait pairs were identified by local genetic correlation analysis implemented within the LAVA software. These regions were brought forward for fine-mapping and colocalisation analysis to understand variants driving the associations.

Please note that:
- the COLOC-reporter conda environment does not relate to the materials within this directory; they are provided for reference and to facilitate replication of analyses performed

- the main analysis scripts are formatted for submission as jobs to a slurm scheduler

### 00_sumstat_processing

The `00_sumstat_processing` directory contains setup scripts for processing of GWAS summary statistics.

Publicly available summary statistics from genome-wide association study (GWAS) for risk of Alzheimer's disease, amyotrophic lateral sclerosis, frontotemporal dementia, Parkinson's disease, and schizophrenia can be obtained and formatted for analysis by running the `process_sumstats.sh` script. This script calls to the individual `prep_*_sumstats.R` scripts to format each set of summary statistics.

For each set of summary statistics, using the `sumstat_IDmatcher.R` script, sampled variants are harmonised to a reference panel (the 1000 Genomes phase 3 European-ancestry dataset (henceforth, the 1KG dataset)) by chromosomal position and rsIDs are assigned.

The ID-matched summary statistics undergo a standard GWAS summary statistic cleaning procedure within an adapted version of the `sumstat_cleaner.R` script written by Oliver Pain for the [GenoPred](https://github.com/opain/GenoPred) resource.

Prerequisites for running `process_sumstats.sh`, including the expected directory structure, are described within the script.

### 01_LDSC_analyses

LDSC (v1.0.1) was used to generate 'global' (i.e., genome-wide) univariate heritability and bivariate genetic correlation estimates.

All analyses with LDSC were performed via the `runLDSC_alltraits.sh` script, and within the LDSC conda environment provided in the github repository alongside the software.

The results of all bivariate analysis from LDSC can be summarised within a single `all.rg` file via the `extract_rg.sh` script. This script also produces the `sample.overlap.txt` file expected by LAVA, using the bivariate intercept as an estimate of sample overlap, and a heatmap of the genome-wide genetic correlations across trait pairs.

`extract_rg.sh` is called with 3 trailing arguments, indicating:

1. the directory containing files from bivariate analysis in LDSC (i.e, those ending in `.rg`) generated by `runLDSC_alltraits.sh`

1. the destination directory for copying the `sample.overlap.txt` output file (i.e., the LAVA 'inputs' directory)

1. the path to the `RG_heatmap.R` script which is used to generate the genetic correlation heatmap


### 02_LAVA_analyses

LAVA is a software which enables 'local' genetic correlation analysis stratifying the genome across semi-independent linkage disequilibrium blocks. Before local genetic correlation analysis is performed between pairs of traits, LAVA derives univariate heritability estimates to remove any regions without sufficient heritability in both of the compared traits for robust correlation analysis.

The local genetic correlation analysis performed is based on scripts provided in the [LAVA GitHub repository](https://github.com/josefin-werme/LAVA). The LAVA repository provides instructions for installing the LAVA R package (v0.1.0) and information about the file structures for the analysis. The updated scripts used for the current analyses are provided here.
 
To briefly overview the analysis protocol: The `lava_rg.sh` script is called to run local genetic correlation analyses across all trait pairs indicated within a `pheno.pairs.txt` file stored within the `02_LAVA_analyses` directory. The analysis is performed by calling to the other scripts in the `02_LAVA_analyses` directory, and points to an 'inputs' directory specified in `settings.sh` that contains relevant input files for LAVA and data for the analysis (see the LAVA [repository](https://github.com/josefin-werme/LAVA) documentation).

### 03_extractLAVA

This directory contains several scripts for extracting and inspecting the results of analysis with LAVA. 

Run `extract_LAVA.sh` to obtain the main LAVA results. This script calls to:

- `getRGregions.R` to prepare files in the format of `set.regions.txt` expected by COLOC-reporter (one file output uses a Bonferroni correction p-value threshold and the other threshold of P<sub>FDR</sub> <0.5). The LAVA results file is also returned with FDR-adjusted P-values appended.

- `plotLAVAoutputs.R` to visualise local univariate heritability and bivariate genetic correlation analyses performed by LAVA.

The `SNP_rg_sig_comparison.R` script can be used to cross-tabulate local genetic correlation significance against occurence of genome-wide significant associations from the compared GWAS.

`LavaAssociationPlot.Rmd` overviews the script for visualising all bivariate analyses from LAVA.

`Investigate_local_rg_characteristics.R` compares the local genetic correlations between positively and negatively correlated loci and builds the volcano / boxplots supplementary figure included within the manuscript.

### 04_coloc-reporter_inputs

This directory contains COLOC-reporter specific input files used for the analyses in the manuscript. Refer to the root directory of this repository for details on their use.
